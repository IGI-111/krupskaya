
$(document).ready(function(){
	var player;
	$("#player").load("templates/player.html", function(){
		player = new Player();
		player.change(new Song());
	});
	
})

function Player() {
	this.audio = $("#player audio")[0];
	this.sliderPrecision = 10000;
	self = this;

	$("#player .playButton").on("click", function(){
		self.audio.play();
	});
	$("#player .pauseButton").on("click", function(){
		self.audio.pause();
	});
	$("#player .stopButton").on("click", function(){
		self.audio.pause();
		self.audio.currentTime = 0;
	});
	$("#player .slider").slider({
		max: self.sliderPrecision,
		orientation: "horizontal",
		range: "min",
		animate: 1000
	});
	$("#player .slider").on("slide", function(event, ui) {
		self.audio.currentTime = self.audio.duration*(ui.value / self.sliderPrecision);
	});
	$("#player audio").on("timeupdate", function(event, ui){
		var pos = self.sliderPrecision*(self.audio.currentTime / self.audio.duration);
		$("#player .slider").slider("value", pos);
	});

	this.wave = new Waveform($("#player canvas"));
	this.change = function(song){
		// change audio value
		$("#player audio").attr("src", song.path);
		// change waveform data
		this.wave.draw(song.wave);
	}
}

function Waveform(container) {
	this.canvas = container[0];

	this.draw = function(data){
		this.canvas.width = data.left.length;
		var ctx = this.canvas.getContext('2d');
		var increment = this.canvas.width/data.left.length;

		var offset = this.canvas.height*(2/3);
		var leftBarGradient = ctx.createLinearGradient(0,0,0,offset);
		leftBarGradient.addColorStop(0,"rgba(255,255,255,0.2)");
		leftBarGradient.addColorStop(1,"rgba(255,255,255,0.3");
		var rightBarGradient = ctx.createLinearGradient(0,offset,0,offset + offset/2);
		rightBarGradient.addColorStop(0,"rgba(255,255,255,0.2)");
		rightBarGradient.addColorStop(1,"rgba(255,255,255,0.3");

		ctx.fillStyle = "lightgrey";
		ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
		ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);

		for (var i = 0, len = data.left.length; i < len; i++) {
			var leftBarHeight = data.left[i]*(offset);
			var rightBarHeight = data.right[i]*(offset/2);
			ctx.fillStyle = leftBarGradient;
			ctx.clearRect(i*increment, Math.ceil(offset-leftBarHeight), increment, Math.floor(leftBarHeight));
			ctx.fillRect(i*increment, Math.ceil(offset-leftBarHeight), increment, Math.floor(leftBarHeight));
			ctx.fillStyle = rightBarGradient;
			ctx.clearRect(i*increment, Math.floor(offset), increment, Math.floor(rightBarHeight));
			ctx.fillRect(i*increment, Math.floor(offset), increment, Math.floor(rightBarHeight));
		}
	}
}

function Song() {
	this.path = "data/02.mp3";
	this.wave = {
		"_generator":"wav2json version 0.3 on Linux (http://goo.gl/af7wg)",
		"left":[0.0427246,0.0388184,0.0424805,0.0659485,0.04776,0.0465088,0.0409241,0.0366211,0.034668,0.0435791,0.0762024,0.0630493,0.060791,0.0588379,0.0612488,0.0858459,0.0476685,0.0707397,0.0711365,0.0439148,0.0971069,0.0744019,0.0888672,0.110199,0.118011,0.0837708,0.0437317,0.10257,0.0975037,0.0630493,0.0662842,0.073822,0.0602112,0.113281,0.0982971,0.11795,0.119751,0.0880432,0.0911865,0.0730896,0.0679932,0.0761108,0.096344,0.128845,0.0996399,0.13858,0.092865,0.141235,0.118774,0.0979919,0.132507,0.0639343,0.110809,0.0955811,0.140411,0.0905762,0.122437,0.0993042,0.090332,0.108643,0.11911,0.111694,0.0871887,0.108948,0.104431,0.0960999,0.0723572,0.0744019,0.0866394,0.0737915,0.0599976,0.0445862,0.0896912,0.0980835,0.136719,0.0909729,0.114197,0.111511,0.101105,0.0629272,0.0710754,0.0957336,0.101257,0.121368,0.0954895,0.124542,0.123016,0.118073,0.144196,0.119354,0.11145,0.13092,0.102753,0.0935669,0.0406494,0.0707397,0.0549927,0.0715332,0.0803223,0.0536804,0.052063,0.156769,0.145477,0.139954,0.168762,0.128143,0.135132,0.134033,0.137909,0.152679,0.123901,0.138702,0.148773,0.139648,0.0630493,0.122894,0.147644,0.120331,0.150208,0.131622,0.139954,0.105591,0.173126,0.178314,0.14267,0.154053,0.125,0.130127,0.140656,0.293304,0.327148,0.322174,0.442352,0.360565,0.357086,0.270691,0.422455,0.260803,0.407532,0.31665,0.433899,0.343445,0.358459,0.408295,0.330505,0.408417,0.260956,0.443848,0.277252,0.444366,0.253662,0.448364,0.26651,0.390839,0.40271,0.444122,0.411682,0.319763,0.381561,0.243591,0.424225,0.445282,0.46048,0.38382,0.262238,0.414154,0.320038,0.444244,0.326294,0.358398,0.332672,0.192719,0.39975,0.162323,0.356079,0.332458,0.438019,0.232391,0.358887,0.395752,0.204468,0.309814,0.165802,0.416565,0.292603,0.344971,0.342041,0.415955,0.344513,0.171204,0.423096,0.224945,0.36264,0.210724,0.427368,0.300842,0.200378,0.405518,0.192322,0.375244,0.182098,0.433655,0.342926,0.21283,0.425537,0.196625,0.387573,0.20697,0.433777,0.190918,0.34137,0.253204,0.388824,0.351196,0.155609,0.364044,0.184937,0.459198,0.462799,0.31189,0.351654,0.329254,0.469666,0.340027,0.400604,0.358826,0.275299,0.341431,0.236511,0.383331,0.418274,0.41507,0.473816,0.374847,0.415985,0.445831,0.315704,0.389465,0.392853,0.278809,0.433441,0.461731,0.47345,0.448608,0.375885,0.415009,0.409332,0.40506,0.387726,0.348602,0.44397,0.448486,0.361664,0.435181,0.479065,0.4133,0.295837,0.392548,0.26123,0.414703,0.331146,0.432953,0.295685,0.3703,0.421356,0.241516,0.42276,0.419495,0.466095,0.356171,0.406555,0.47467,0.33371,0.451202,0.256958,0.357666,0.339691,0.392731,0.279907,0.332245,0.376862,0.38446,0.46579,0.395294,0.437714,0.312256,0.42572,0.34552,0.325104,0.296783,0.381866,0.377197,0.171295,0.356964,0.36972,0.397217,0.404572,0.434631,0.316833,0.183502,0.411011,0.212158,0.339417,0.194824,0.427795,0.389343,0.255768,0.416656,0.194214,0.426758,0.339447,0.467957,0.326447,0.375885,0.384247,0.282928,0.305542,0.212646,0.422882,0.278961,0.40033,0.404388,0.313904,0.391357,0.407074,0.464783,0.295868,0.384125,0.353363,0.43103,0.411499,0.419037,0.409546,0.264862,0.411987,0.212921,0.410828,0.338593,0.455353,0.446259,0.344025,0.381836,0.350586,0.420959,0.410736,0.244141,0.417358,0.217529,0.376953,0.28006,0.412262,0.374969,0.361267,0.438538,0.373718,0.427673,0.427948,0.37796,0.431183,0.316711,0.373413,0.398315,0.396881,0.340454,0.477051,0.436188,0.482117,0.34256,0.371552,0.425598,0.355743,0.436371,0.379822,0.420441,0.467194,0.435638,0.370087,0.423676,0.423492,0.426727,0.437134,0.465973,0.450134,0.469452,0.448578,0.375275,0.449432,0.372009,0.477325,0.46991,0.383179,0.3974,0.40625,0.440277,0.431152,0.415436,0.444489,0.392151,0.3396,0.282776,0.265015,0.295166,0.44339,0.392242,0.379181,0.453674,0.331451,0.407074,0.259888,0.407227,0.25885,0.439972,0.380585,0.224243,0.352692,0.187317,0.365967,0.34198,0.412018,0.398193,0.292175,0.380035,0.171295,0.389709,0.353271,0.415741,0.387329,0.401489,0.392731,0.291931,0.378204,0.168365,0.323669,0.403748,0.459595,0.230072,0.39975,0.382233,0.341919,0.411621,0.263702,0.388641,0.386597,0.399811,0.322754,0.386139,0.35437,0.375916,0.40918,0.243103,0.340912,0.271912,0.374268,0.395844,0.328094,0.372162,0.242889,0.36264,0.2883,0.363922,0.406464,0.353058,0.407471,0.2388,0.360199,0.358582,0.365723,0.355591,0.281219,0.343658,0.432465,0.353516,0.233276,0.380859,0.177551,0.414734,0.391724,0.227631,0.321716,0.214996,0.409668,0.272919,0.41272,0.461456,0.370636,0.341248,0.241943,0.295837,0.319519,0.389526,0.487823,0.330658,0.362579,0.473328,0.415253,0.429291,0.403381,0.417358,0.440704,0.426361,0.449646,0.452728,0.45108,0.422852,0.463318,0.450409,0.428284,0.463745,0.442841,0.415405,0.428894,0.427277,0.485107,0.425873,0.390503,0.337219,0.257599,0.260956,0.34906,0.425385,0.399658,0.44455,0.312958,0.4375,0.291595,0.453949,0.243347,0.437225,0.322357,0.392487,0.428986,0.350647,0.364075,0.396698,0.347961,0.405609,0.396149,0.401306,0.279327,0.372131,0.249115,0.399017,0.384613,0.416595,0.337006,0.269897,0.394379,0.359985,0.350494,0.369781,0.435364,0.372406,0.340393,0.424774,0.326599,0.393158,0.274475,0.391754,0.340424,0.344055,0.374878,0.365326,0.368011,0.384613,0.488312,0.307526,0.27359,0.391083,0.184082,0.356384,0.154602,0.41684,0.202423,0.332062,0.361511,0.202545,0.438812,0.474274,0.457733,0.361786,0.417328,0.399567,0.304871,0.408112,0.225769,0.39621,0.255707,0.407776,0.306702,0.215118,0.448486,0.410004,0.457886,0.35611,0.435608,0.409821,0.258392,0.354919,0.260101,0.424866,0.325531,0.360565,0.42691,0.271118,0.367981,0.392242,0.470673,0.332855,0.33905,0.418335,0.34137,0.379211,0.296326,0.441772,0.319702,0.427032,0.352661,0.412994,0.387878,0.446198,0.446838,0.360962,0.466797,0.426575,0.459534,0.427399,0.24173,0.34848,0.355957,0.356415,0.4776,0.39444,0.456696,0.451233,0.350037,0.45755,0.427643,0.405914,0.388214,0.401398,0.400696,0.471436,0.385315,0.391724,0.393402,0.265137,0.417175,0.285492,0.428467,0.307465,0.382965,0.464508,0.443726,0.406769,0.435028,0.459991,0.378296,0.449738,0.378235,0.391388,0.398193,0.314331,0.372925,0.455322,0.414032,0.336914,0.412933,0.393921,0.393677,0.418854,0.301422,0.387817,0.369568,0.407532,0.450592,0.286774,0.372314,0.374512,0.379639,0.372559,0.364532,0.402893,0.391968,0.477448,0.347687,0.401093,0.451874,0.320587,0.383331,0.332703,0.397766,0.355042,0.405182,0.314819,0.425171,0.440369,0.463898,0.455841,0.31601,0.385254,0.465546,0.317078,0.387207,0.378998,0.452301,0.350677,0.429657,0.427551,0.427887,0.449371,0.460938,0.453857,0.366302,0.426727,0.418213,0.334869,0.407104,0.314545,0.447906,0.272186,0.377716,0.38147,0.408661,0.390808,0.371094,0.424347,0.402466,0.281616,0.428192,0.359711,0.406921,0.301392,0.360046,0.438965,0.380371,0.413208,0.316162,0.370636,0.375336,0.397369,0.404785,0.348663,0.420685,0.296539,0.373322,0.337738,0.348328,0.394348,0.384247,0.342957,0.280182,0.435394,0.410248,0.411835,0.4617,0.360687,0.430389,0.299347,0.41272,0.289276,0.367828,0.423798,0.337555,0.349365,0.327271,0.302673,0.286011,0.339355,0.318024,0.25296,0.285675,0.189789,0.270966,0.188812,0.226288,0.220459,0.199768,0.230499,0.230011,0.245941,0.189636,0.249481,0.19458,0.161285,0.186615,0.127991,0.173096,0.0969238,0.127838,0.101807,0.0844116,0.0632324,0.0717468,0.0603638,0.0415649,0.0526733,0.0452881,0.0307312,0.0301819,0.0293579],
		"right":[0.0233154,0.038269,0.036438,0.0532532,0.0504456,0.0308228,0.0402527,0.0715027,0.043396,0.0409546,0.0526428,0.0433655,0.0411987,0.047699,0.0469055,0.0663147,0.0340881,0.0507507,0.0625916,0.0427856,0.0760498,0.0772095,0.0546875,0.0962219,0.101807,0.0590515,0.0330811,0.0904541,0.0888367,0.0696106,0.0804749,0.0748901,0.0565186,0.0946655,0.0906677,0.0856323,0.0750732,0.11731,0.0962524,0.073822,0.0601501,0.055603,0.0582581,0.114838,0.0872192,0.115387,0.0891113,0.100922,0.109833,0.0592041,0.10376,0.0777893,0.0986023,0.0968933,0.118073,0.0840454,0.124634,0.0921021,0.0820923,0.107574,0.108398,0.0979614,0.0725403,0.0661316,0.0946655,0.0681152,0.0683899,0.0657349,0.0629272,0.0669861,0.0515442,0.0524292,0.0809326,0.0988159,0.10675,0.0958557,0.0787659,0.0996399,0.0864563,0.0617065,0.0590515,0.106476,0.0801697,0.101532,0.0698853,0.113678,0.124634,0.0990601,0.132446,0.0959473,0.0995483,0.0950928,0.0858154,0.0923462,0.0400696,0.069397,0.06073,0.0679626,0.065094,0.0436707,0.0517578,0.151581,0.134003,0.129456,0.133636,0.133789,0.112213,0.133179,0.135132,0.130707,0.115387,0.127441,0.119751,0.0993958,0.0473022,0.114197,0.131531,0.116272,0.137054,0.117615,0.116821,0.092926,0.144348,0.156647,0.107788,0.127625,0.104187,0.107727,0.108551,0.291718,0.338684,0.314362,0.464661,0.3367,0.41275,0.26181,0.412872,0.318298,0.404694,0.287964,0.430023,0.30426,0.393036,0.410034,0.286621,0.41156,0.237762,0.380981,0.303528,0.409149,0.284119,0.36264,0.288055,0.39978,0.412048,0.420929,0.42572,0.305664,0.37796,0.244354,0.396271,0.432098,0.447601,0.401581,0.335602,0.381042,0.232788,0.369598,0.290131,0.356934,0.3367,0.250732,0.427612,0.202759,0.388794,0.376984,0.420074,0.222107,0.364655,0.395416,0.186493,0.325134,0.127838,0.369873,0.233673,0.369324,0.338989,0.402588,0.329285,0.129517,0.411163,0.177429,0.390778,0.184418,0.360016,0.310638,0.209656,0.380035,0.167419,0.340546,0.15741,0.377991,0.322144,0.198578,0.413055,0.200317,0.350067,0.182648,0.400238,0.178497,0.340515,0.205719,0.356537,0.34903,0.157776,0.314636,0.173798,0.414734,0.419525,0.330017,0.345215,0.312469,0.442688,0.298431,0.404724,0.381195,0.306396,0.40097,0.268768,0.421417,0.378387,0.442047,0.453003,0.355408,0.437897,0.458588,0.283844,0.407562,0.411041,0.245392,0.385101,0.379639,0.457184,0.412445,0.401825,0.441589,0.41507,0.345856,0.393372,0.297821,0.383698,0.382629,0.465546,0.421173,0.468475,0.423523,0.303589,0.390442,0.254974,0.388947,0.288055,0.376038,0.317108,0.403381,0.407043,0.243439,0.440826,0.370789,0.463013,0.293579,0.419464,0.457703,0.304108,0.416901,0.276123,0.382477,0.276093,0.415649,0.290192,0.331818,0.432556,0.393066,0.458679,0.379547,0.402863,0.326691,0.404602,0.309509,0.403107,0.331116,0.36087,0.378571,0.201569,0.363281,0.367645,0.3479,0.440216,0.399323,0.336121,0.173859,0.387787,0.164459,0.341187,0.178925,0.394501,0.347534,0.221008,0.399567,0.143738,0.422729,0.324799,0.47937,0.352875,0.342804,0.384583,0.228943,0.356812,0.27005,0.410095,0.23703,0.34433,0.35022,0.276764,0.410187,0.385529,0.437561,0.27179,0.398315,0.36557,0.459045,0.383698,0.393158,0.42337,0.216827,0.373718,0.174469,0.402954,0.387817,0.437592,0.448273,0.345215,0.445068,0.307617,0.393005,0.400604,0.250641,0.458618,0.260559,0.386017,0.221954,0.403931,0.352539,0.395691,0.423706,0.357422,0.432159,0.437439,0.354797,0.424805,0.265045,0.343994,0.405029,0.422607,0.37439,0.454193,0.43573,0.435181,0.330933,0.385132,0.396149,0.335907,0.394714,0.423676,0.422211,0.438568,0.429169,0.367401,0.420441,0.401398,0.359528,0.44278,0.456818,0.413086,0.41275,0.420502,0.421722,0.39566,0.3703,0.457916,0.435577,0.401886,0.40332,0.386414,0.422668,0.384766,0.40979,0.442932,0.410339,0.299316,0.253754,0.220459,0.264313,0.384796,0.411316,0.426086,0.423798,0.307648,0.385406,0.259888,0.382477,0.230438,0.382233,0.38446,0.249207,0.345276,0.207428,0.387817,0.338013,0.310577,0.391174,0.302765,0.360718,0.241241,0.337189,0.248322,0.342438,0.380157,0.375458,0.400818,0.173828,0.414093,0.22113,0.352905,0.400238,0.438354,0.243042,0.354187,0.366455,0.343445,0.415497,0.249298,0.331543,0.232422,0.36969,0.316406,0.364471,0.345062,0.365509,0.406158,0.217224,0.357574,0.364288,0.412354,0.387238,0.263,0.352295,0.333069,0.382507,0.201111,0.352936,0.393524,0.331116,0.412079,0.284363,0.400208,0.206879,0.344391,0.443481,0.372345,0.385376,0.358734,0.360413,0.135162,0.370361,0.191376,0.364532,0.402679,0.230774,0.302185,0.272308,0.450897,0.269104,0.320435,0.389374,0.295898,0.321014,0.142548,0.340912,0.435364,0.271729,0.444794,0.312134,0.37793,0.419617,0.394196,0.378998,0.398193,0.429199,0.393311,0.424957,0.432343,0.435333,0.407013,0.407928,0.430511,0.456696,0.408539,0.416199,0.374512,0.421753,0.421631,0.427002,0.425842,0.438416,0.379852,0.299561,0.287506,0.25705,0.366638,0.41394,0.387787,0.4328,0.320618,0.45639,0.325531,0.426819,0.256653,0.450775,0.388916,0.391449,0.4534,0.413116,0.349091,0.428955,0.378845,0.381012,0.400177,0.442841,0.251038,0.374512,0.255035,0.370819,0.360168,0.414856,0.37204,0.268585,0.398499,0.373993,0.405243,0.319916,0.457153,0.413361,0.313812,0.431213,0.28476,0.351624,0.31424,0.375183,0.364899,0.380096,0.421417,0.374847,0.43631,0.467804,0.454803,0.315674,0.241333,0.33374,0.175079,0.359406,0.143036,0.383881,0.162659,0.384552,0.340149,0.17157,0.427582,0.470184,0.408875,0.321594,0.423004,0.379272,0.223602,0.404602,0.218292,0.408691,0.205872,0.431091,0.282196,0.243378,0.402344,0.442566,0.403168,0.319275,0.441223,0.36618,0.294739,0.384277,0.258209,0.414368,0.230194,0.373383,0.351776,0.28772,0.378082,0.414642,0.452637,0.305176,0.348236,0.415344,0.296661,0.350403,0.267517,0.392761,0.295654,0.426392,0.28299,0.390106,0.363708,0.417084,0.413147,0.360596,0.444763,0.384033,0.397614,0.452881,0.246826,0.375031,0.386047,0.402222,0.46402,0.372589,0.41449,0.421631,0.310577,0.433838,0.435699,0.419128,0.448303,0.440399,0.416626,0.458527,0.333221,0.399231,0.351227,0.276245,0.42038,0.263824,0.432159,0.246918,0.431732,0.423615,0.403748,0.426331,0.395996,0.415161,0.3302,0.392731,0.375092,0.373138,0.434906,0.301605,0.358582,0.409058,0.411377,0.321899,0.453186,0.413696,0.454254,0.466644,0.295013,0.421661,0.433533,0.431152,0.417145,0.275604,0.300751,0.343872,0.437012,0.392303,0.305328,0.348358,0.377991,0.46936,0.323425,0.404236,0.405518,0.326599,0.406006,0.304718,0.381165,0.346588,0.434479,0.309418,0.429077,0.437714,0.461243,0.442902,0.295593,0.329224,0.41333,0.344269,0.40448,0.247681,0.407898,0.317993,0.37793,0.432983,0.452271,0.415863,0.438751,0.450165,0.278687,0.438934,0.392914,0.292297,0.383728,0.274597,0.435364,0.23877,0.387848,0.426422,0.425537,0.408356,0.349762,0.426178,0.409882,0.277954,0.461212,0.333954,0.381256,0.355774,0.384094,0.369568,0.267853,0.337921,0.297455,0.34903,0.395081,0.424469,0.408478,0.31073,0.358856,0.285217,0.413544,0.296448,0.323639,0.367279,0.31485,0.335968,0.25943,0.361603,0.397675,0.336212,0.444519,0.403778,0.411591,0.244232,0.391968,0.287201,0.357971,0.404877,0.386108,0.258942,0.29776,0.316406,0.316559,0.354675,0.283936,0.238556,0.298035,0.15979,0.229889,0.205048,0.207794,0.17865,0.15451,0.264374,0.170929,0.222107,0.16272,0.246613,0.204742,0.0979614,0.162537,0.0867615,0.149261,0.0804138,0.0874329,0.0744324,0.0601807,0.0575256,0.0713806,0.0505981,0.037384,0.0455627,0.0305481,0.0226746,0.0248718,0.0228271],
		"duration":465.136017
	}
}
