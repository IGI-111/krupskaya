
$(document).ready(function(){
	var player;
	$("#player").load("templates/player.html", function(){
		player = new Player();
	});

})

function Player() {
	this.audio = $("#player audio")[0];
	this.sliderPrecision = 10000;
	self = this;

	$("#player .playButton").on("click", function(){
		self.audio.play();
	});
	$("#player .pauseButton").on("click", function(){
		self.audio.pause();
	});
	$("#player .slider").slider({
		max: self.sliderPrecision,
		orientation: "horizontal",
		range: "min"
	});
	$("#player .slider").on("slide", function(event, ui) {
		self.audio.currentTime = self.audio.duration*(ui.value / self.sliderPrecision);
	});
	$("#player audio").on("timeupdate", function(event, ui){
		var pos = self.sliderPrecision*(self.audio.currentTime / self.audio.duration);
		$("#player .slider").slider("value", pos);
	});

	var waveformData = {
		left:[0,0.562592,0.522583,0.606262,0.53894,0.558868,0.504761,0.43573,0.189697,0.332245,0.342346,0.286163,0.241455,0.162323,0.273682,0.134277,0.545532,0.564728,0.574219,0.539307,0.618347,0.518707,0.258911,0.31723,0.152954,0.308807,0.126129,0.236237,0.10257,0.250122,0.333221,0.546021,0.588684,0.526184,0.654114,0.500183,0.489868,0.128265,0.31778,0.189575,0.302185,0.248871,0.339569,0.32785,0.273712,0.542664,0.578003,0.591461,0.513916,0.68866,0.516785,0.263672,0.320648,0.193176,0.588257,0.581787,0.663086,0.70462,0.637177,0.364075,0.54129,0.561279,0.595764,0.608185,0.620728,0.519989,0.142059,0.326019,0.134888,0.300049,0.200378,0.241577,0.254669,0.263214,0.562195,0.494141,0.591309,0.549988,0.61676,0.624786,0.418732,0.313751,0.349274,0.549011,0.583679,0.656036,0.615448,0.69223,0.502289,0.589722,0.485016,0.598755,0.541748,0.72757,0.614868,0.391815,0.382172,0.314148,0.340118,0.146027,0.335968,0.173981,0.376343,0.622528,0.579803,0.594391,0.595367,0.69574,0.567749,0.515137,0.189331,0.398132,0.3685,0.362213,0.374451,0.32486,0.469055,0.317352,0.999969,0.885803,0.997925,0.774963,0.999969,0.928009,0.754028,0.996185,0.552521,0.923126,0.485199,0.999969,0.509521,0.839783,0.477722,0.999969,0.999969,0.768219,0.97583,0.942963,0.949585,0.558563,0.999969,0.467163,0.999969,0.99823,0.985474,0.99762,0.963287,0.999969,0.866638,0.951416,0.728424,0.999969,0.686859,0.909607,0.999969,0.840851,0.832672,0.579742,0.972961,0.594208,0.957977,0.502197,0.981964,0.704651,0.991272,0.999969,0.738831,0.958588,0.617767,0.954254,0.601196,0.999969,0.973907,0.952728,0.956329,0.890686,0.995941,0.840057,0.999969,0.768494,0.999847,0.854889,0.838867,0.704285,0.999969,0.999969,0.999969,0.982635,0.570587,0.999969,0.788391,0.976318,0.797668,0.999969,0.763794,0.999207,0.951813,0.923431,0.983856,0.603516,0.982758,0.780182,0.998169,0.767914,0.999969,0.999969,0.999969,0.962311,0.800995,0.960693,0.85318,0.966187,0.700806,0.999969,0.738007,0.999969,0.986847,0.766785,0.929871,0.846619,0.999969,0.85675,0.999969,0.779572,0.997009,0.739197,0.978668,0.994629,0.611145,0.908508,0.996277,0.813263,0.94455,0.999969,0.968018,0.985138,0.826935,0.890167,0.999969,0.778412,0.961853,0.818787,0.976959,0.699188,0.941589,0.809601,0.943695,0.955841,0.915436,0.987488,0.924011,0.963135,0.724274,0.965485,0.579071,0.93808,0.75174,0.952118,0.973633,0.84848,0.956451,0.999969,0.855743,0.991943,0.998962,0.763,0.912659,0.957336,0.90274,0.998962,0.92569,0.974457,0.668732,0.995514,0.756317,0.999969,0.997101,0.982483,0.999969,0.964783,0.957977,0.684998,0.932037,0.798798,0.999969,0.729645,0.9935,0.785278,0.96347,0.999908,0.95816,0.829651,0.792755,0.982391,0.792389,0.982025,0.795685,0.99942,0.836853,0.971893,0.999969,0.914215,0.999969,0.708771,0.999969,0.938904,0.981567,0.866974,0.980042,0.989258,0.996399,0.996887,0.944824,0.999969,0.999969,0.986115,0.945343,0.993225,0.958191,0.992584,0.999969,0.999969,0.989868,0.969879,0.938965,0.811218,0.96756,0.784088,0.998352,0.999969,0.970551,0.999969,0.892365,0.975189,0.855377,0.962219,0.799835,0.995667,0.708038,0.973969,0.999969,0.960754,0.999969,0.727448,0.999969,0.966888,0.999969,0.981323,0.996338,0.961121,0.986847,0.997498,0.979736,0.997559,0.853424,0.999969,0.644806,0.965027,0.62915,0.961029,0.732666,0.970642,0.964905,0.786957,0.816193,0.550018,0.999969,0.755981,0.999786,0.789215,0.999969,0.809753,0.873932,0.9888,0.933228,0.999969,0.999786,0.966644,0.967743,0.935944,0.900177,0.999969,0.993286,0.93512,0.999146,0.771698,0.975708,0.629578,0.993439,0.766235,0.955322,0.702728,0.999969,0.82608,0.841339,0.973907,0.901642,0.9758,0.768463,0.986267,0.554901,0.954803,0.962677,0.88324,0.990173,0.927551,0.999969,0.983276,0.999969,0.913116,0.986694,0.843445,0.985229,0.999969,0.841553,0.87735,0.55423,0.999969,0.616028,0.867279,0.492889,0.981659,0.516632,0.855713,0.999969,0.834076,0.978058,0.8255,0.982849,0.913452,0.848022,0.446014,0.999969,0.992767,0.999969,0.999969,0.992096,0.982941,0.827026,0.988617,0.825287,0.951996,0.753082,0.999969,0.905396,0.825928,0.999969,0.581451,0.8414,0.430389,0.981201,0.519012,0.933105,0.484558,0.991974,0.999969,0.914001,0.999969,0.896454,0.982452,0.547943,0.999756,0.43512,0.999969,0.990173,0.975586,0.926117,0.765869,0.947144,0.849213,0.999969,0.744568,0.999969,0.729492,0.956238,0.999969,0.804962,0.999969,0.782684,0.999969,0.614349,0.952179,0.746307,0.994293,0.73288,0.971832,0.991119,0.90979,0.981842,0.926605,0.999969,0.667999,0.972565,0.734619,0.999969,0.890167,0.999969,0.998474,0.871857,0.926941,0.76181,0.991547,0.828247,0.96933,0.771454,0.999969,0.954529,0.971832,0.972778,0.5336,0.974396,0.71167,0.999969,0.793976,0.999969,0.746307,0.985229,0.906738,0.979797,0.999969,0.684418,0.96402,0.968506,0.960052,0.874237,0.989471,0.999969,0.999969,0.929657,0.753784,0.999725,0.716797,0.958527,0.808502,0.964966,0.733368,0.95929,0.999969,0.961517,0.973602,0.816406,0.997833,0.893951,0.922729,0.743927,0.965637,0.638824,0.960175,0.999969,0.895538,0.999664,0.699036,0.999969,0.925812,0.920715,0.991272,0.999969,0.978882,0.864044,0.924133,0.838531,0.985321,0.942261,0.995911,0.708374,0.968384,0.778107,0.93869,0.944824,0.860718,0.994171,0.782196,0.997742,0.735138,0.999969,0.644165,0.986603,0.7612,0.968384,0.999695,0.786438,0.964386,0.961395,0.829712,0.849548,0.999969,0.846283,0.999969,0.996429,0.999969,0.987335,0.747894,0.981567,0.760742,0.973694,0.737305,0.959534,0.78241,0.98465,0.968781,0.914612,0.976074,0.687714,0.93985,0.814453,0.997162,0.689087,0.98114,0.728485,0.973358,0.975067,0.984802,0.860413,0.959167,0.999969,0.790131,0.980621,0.611511,0.987213,0.832581,0.991028,0.985413,0.942352,0.999969,0.722809,0.999969,0.80481,0.931274,0.83902,0.999969,0.949493,0.919891,0.999969,0.878113,0.928619,0.750763,0.981537,0.69516,0.999969,0.968964,0.898407,0.886536,0.915771,0.999969,0.992706,0.999969,0.812256,0.936615,0.562683,0.893311,0.947815,0.991882,0.985962,0.781036,0.999207,0.648743,0.79718,0.474304,0.999969,0.720795,0.986908,0.995911,0.936768,0.94751,0.670502,0.989502,0.945892,0.999969,0.965179,0.963837,0.947601,0.999969,0.996246,0.999969,0.960114,0.909576,0.984711,0.721252,0.896332,0.620605,0.999969,0.953339,0.87735,0.999969,0.748749,0.823944,0.600677,0.999969,0.798981,0.997528,0.720825,0.999969,0.893066,0.946289,0.978149,0.913605,0.999969,0.995056,0.962341,0.91098,0.966919,0.944946,0.999969,0.999969,0.846191,0.999969,0.880005,0.934509,0.564178,0.981445,0.679779,0.969147,0.953552,0.956421,0.999969,0.906097,0.999725,0.822357,0.934174,0.66684,0.998077,0.676025,0.960632,0.999969,0.842224,0.999969,0.64325,0.999969,0.807098,0.999969,0.987427,0.999969,0.693726,0.96933,0.996796,0.926483,0.98053,0.579071,0.99527,0.749329,0.970642,0.703979,0.997131,0.820618,0.999969,0.999969,0.713715,0.981781,0.61438,0.990112,0.88739,0.985016,0.793854,0.966339,0.997833,0.999969,0.992065,0.976837,0.999969,0.874939,0.982361,0.999969,0.998047,0.867737,0.992432,0.998718,0.999969,0.999969,0.971527,0.990997,0.998444,0.98703,0.892303,0.997009,0.999603,0.526672,0.356628,0.336731,0.279144,0.177155,0.317383,0.152771,0.245239,0.161804,0.31485,0.281067,0.293335,0.322113,0.282288,0.425079,0.392853,0.430664,0.192291,0.268707,0.298798,0.30307,0.380981,0.42218,0.441406,0.338348],
		right:[0,0.529663,0.49472,0.575897,0.510284,0.527924,0.473724,0.408844,0.184052,0.315674,0.327209,0.278564,0.231567,0.157928,0.266602,0.13205,0.528931,0.537964,0.539276,0.51709,0.585541,0.49115,0.244873,0.30069,0.146759,0.306885,0.122009,0.230164,0.0994873,0.236298,0.321259,0.517944,0.553864,0.500397,0.617889,0.469849,0.464661,0.125641,0.3078,0.179871,0.296478,0.235565,0.322327,0.31839,0.261078,0.510437,0.549927,0.56311,0.487854,0.647095,0.490051,0.257721,0.302826,0.188751,0.55899,0.546509,0.621887,0.665039,0.612701,0.336517,0.511963,0.530609,0.558624,0.578827,0.588013,0.487823,0.132843,0.319885,0.137421,0.293854,0.192505,0.239532,0.243011,0.273254,0.545837,0.48465,0.597473,0.517487,0.591888,0.579193,0.393097,0.306824,0.33786,0.530396,0.566467,0.611664,0.608124,0.669006,0.477264,0.558777,0.478943,0.588409,0.502197,0.707733,0.578217,0.36441,0.360657,0.29541,0.359619,0.151062,0.332184,0.174042,0.370911,0.57132,0.583435,0.594818,0.567444,0.654724,0.581696,0.497498,0.197937,0.391663,0.348389,0.38031,0.371643,0.375214,0.467957,0.267395,0.992859,0.75177,0.936401,0.727966,0.999969,0.841858,0.777435,0.999969,0.575836,0.823425,0.470062,0.999969,0.567841,0.940979,0.454559,0.999969,0.999969,0.851013,0.969391,0.889679,0.945892,0.515717,0.999969,0.43634,0.999969,0.98114,0.984894,0.999969,0.99588,0.99527,0.862823,0.91806,0.721466,0.999969,0.712524,0.852356,0.996826,0.756775,0.874451,0.444061,0.96814,0.627319,0.963623,0.452087,0.986511,0.803497,0.985565,0.99707,0.850677,0.833069,0.511719,0.994904,0.597809,0.999969,0.996338,0.962708,0.853973,0.889923,0.999969,0.75058,0.972015,0.810883,0.999969,0.71759,0.850433,0.756622,0.999969,0.987457,0.981232,0.999512,0.58374,0.929352,0.731079,0.999969,0.728241,0.962067,0.612427,0.997467,0.973022,0.817261,0.999969,0.662842,0.999969,0.924377,0.979034,0.73587,0.999969,0.997406,0.999969,0.90918,0.797333,0.974487,0.849304,0.898041,0.735138,0.999969,0.710876,0.987854,0.999969,0.908234,0.963287,0.72467,0.997223,0.76651,0.927734,0.735657,0.999969,0.757263,0.934113,0.999969,0.670563,0.984589,0.985565,0.793823,0.970551,0.984619,0.929932,0.999969,0.925079,0.791473,0.999969,0.901886,0.852966,0.896393,0.978577,0.72464,0.820801,0.851379,0.991638,0.893341,0.779572,0.995209,0.931763,0.99411,0.702332,0.970734,0.773132,0.99884,0.740662,0.970856,0.999969,0.869324,0.956024,0.838043,0.852661,0.993011,0.999115,0.638062,0.998383,0.858002,0.999969,0.947632,0.910217,0.999969,0.726318,0.939209,0.831421,0.999969,0.87915,0.950562,0.965424,0.912842,0.93866,0.753113,0.984619,0.792084,0.999969,0.722595,0.983215,0.770172,0.986145,0.958008,0.833191,0.957642,0.814148,0.999512,0.830688,0.971527,0.814667,0.999969,0.821228,0.999969,0.999969,0.975372,0.999969,0.75946,0.999969,0.811371,0.999969,0.870056,0.999969,0.873688,0.856598,0.96756,0.849548,0.921906,0.889191,0.946747,0.928131,0.934937,0.912933,0.999969,0.95752,0.952423,0.999969,0.9104,0.848877,0.782501,0.999451,0.927917,0.961914,0.93515,0.963318,0.977844,0.861725,0.96637,0.823151,0.998077,0.823212,0.999969,0.768707,0.986847,0.999969,0.887573,0.972168,0.89032,0.993164,0.908478,0.999969,0.982574,0.952942,0.91745,0.975433,0.993652,0.975311,0.986694,0.785217,0.988495,0.502808,0.835785,0.415863,0.990936,0.732758,0.917999,0.975555,0.786377,0.814087,0.531677,0.999969,0.690125,0.999969,0.556946,0.999969,0.660461,0.672272,0.966064,0.855377,0.999969,0.958435,0.799805,0.817474,0.97348,0.824402,0.986481,0.867188,0.789062,0.990173,0.635376,0.828491,0.529541,0.991241,0.84201,0.944183,0.660004,0.99707,0.776123,0.91925,0.976929,0.912872,0.973755,0.521637,0.991821,0.364258,0.775238,0.948212,0.836975,0.99649,0.820007,0.999969,0.856567,0.987885,0.910858,0.980377,0.746368,0.99942,0.981842,0.870087,0.920929,0.514771,0.999969,0.606659,0.870819,0.462769,0.965454,0.603638,0.844635,0.999969,0.878754,0.954926,0.689331,0.965607,0.884125,0.824554,0.45224,0.994324,0.846588,0.999969,0.986633,0.978333,0.999969,0.999969,0.999878,0.766113,0.982178,0.71933,0.997345,0.868561,0.736023,0.999969,0.649414,0.81015,0.519257,0.946777,0.477173,0.881714,0.469452,0.988312,0.99292,0.95871,0.976746,0.875702,0.902924,0.541656,0.961884,0.465118,0.954346,0.828796,0.999969,0.829468,0.750519,0.958588,0.695099,0.933624,0.76825,0.999969,0.793488,0.835175,0.999969,0.891876,0.999969,0.807709,0.99588,0.602814,0.991547,0.678467,0.994446,0.76123,0.949066,0.999969,0.865234,0.982849,0.743469,0.999969,0.685822,0.909576,0.944519,0.999969,0.854492,0.999969,0.999969,0.825775,0.999725,0.700012,0.999969,0.699066,0.889709,0.789337,0.999969,0.999969,0.890015,0.996521,0.600769,0.966888,0.763062,0.994476,0.78125,0.929291,0.674072,0.999969,0.965454,0.97699,0.989624,0.713165,0.999969,0.9953,0.990387,0.90979,0.97403,0.998688,0.996033,0.858551,0.794067,0.99942,0.840363,0.90683,0.799316,0.998322,0.739777,0.961487,0.997284,0.978577,0.926666,0.706909,0.938232,0.75238,0.874573,0.755096,0.996643,0.680298,0.899536,0.998901,0.798645,0.975647,0.674164,0.991699,0.777954,0.955353,0.869598,0.999969,0.902893,0.94397,0.999481,0.867676,0.96637,0.695282,0.998627,0.679504,0.892761,0.845673,0.981293,0.876617,0.893127,0.985199,0.792999,0.92511,0.682556,0.999969,0.913513,0.999969,0.686707,0.979889,0.968781,0.782898,0.972137,0.902588,0.810852,0.824432,0.999969,0.804565,0.947418,0.999969,0.999725,0.993439,0.711945,0.999969,0.957001,0.997101,0.899323,0.99234,0.85498,0.96701,0.905914,0.869324,0.918701,0.778046,0.975372,0.81778,0.993408,0.658722,0.981537,0.822815,0.999969,0.989532,0.915985,0.871277,0.883698,0.999969,0.7612,0.914703,0.621887,0.992981,0.823761,0.982239,0.986084,0.995941,0.999969,0.727112,0.999969,0.822876,0.973267,0.717072,0.999969,0.942108,0.905884,0.999969,0.924133,0.983337,0.864014,0.949188,0.728882,0.973572,0.843048,0.964264,0.917816,0.929016,0.999969,0.923859,0.954346,0.648071,0.936646,0.450348,0.765533,0.966034,0.964142,0.976501,0.798676,0.990479,0.623779,0.764435,0.472534,0.999969,0.743317,0.951172,0.997253,0.767334,0.83194,0.502594,0.954437,0.869202,0.94046,0.911438,0.846558,0.836487,0.927399,0.933838,0.937988,0.792755,0.780334,0.942261,0.585022,0.765198,0.388519,0.998169,0.86496,0.84906,0.988495,0.796417,0.792358,0.577606,0.974762,0.753998,0.935577,0.4758,0.999969,0.711731,0.833618,0.995026,0.820038,0.966736,0.910767,0.863403,0.860107,0.971558,0.794281,0.999969,0.979736,0.919006,0.998749,0.794159,0.969269,0.72406,0.998169,0.75589,0.999969,0.969391,0.956879,0.921753,0.930878,0.935394,0.776306,0.93576,0.803711,0.999969,0.697968,0.921295,0.992798,0.734344,0.998718,0.780853,0.999969,0.761353,0.999969,0.98465,0.999969,0.672821,0.914001,0.998413,0.759216,0.807953,0.608734,0.996063,0.723175,0.967743,0.82489,0.964264,0.750305,0.960052,0.999969,0.77005,0.961945,0.603302,0.997528,0.774689,0.955841,0.608795,0.990387,0.999969,0.999969,0.975494,0.891571,0.999969,0.762238,0.98526,0.999969,0.999969,0.832764,0.992401,0.932922,0.971741,0.999969,0.959106,0.987122,0.999969,0.982178,0.999969,0.999969,0.982483,0.557159,0.357025,0.310791,0.258148,0.18399,0.298309,0.147644,0.237946,0.155487,0.291992,0.268982,0.280334,0.299591,0.271484,0.401428,0.371155,0.41153,0.183777,0.261139,0.28183,0.290466,0.371216,0.406067,0.420898,0.386017]
	}
	this.wave = new Waveform($("#player canvas"), waveformData);
	this.wave.draw();
	this.change = function(songId){
		// change audio value
		// change waveform data
	}
}

function Waveform(container, data) {
	this.data = data;
	this.canvas = container[0];

	this.draw = function(){
		this.canvas.width = data.left.length;
		var ctx = this.canvas.getContext('2d');
		var increment = this.canvas.width/data.left.length;

		var offset = this.canvas.height*(2/3);
		var leftBarGradient = ctx.createLinearGradient(0,0,0,offset);
		leftBarGradient.addColorStop(0,"red");
		leftBarGradient.addColorStop(1,"darkred");
		var rightBarGradient = ctx.createLinearGradient(0,offset,0,offset + offset/2);
		rightBarGradient.addColorStop(0,"red");
		rightBarGradient.addColorStop(1,"darkred");

		for (var i = 0, len = data.left.length; i < len; i++) {
			var leftBarHeight = data.left[i]*(offset);
			var rightBarHeight = data.right[i]*(offset/2);
			ctx.fillStyle = leftBarGradient;
			ctx.fillRect(i*increment, Math.ceil(offset-leftBarHeight), increment, Math.floor(leftBarHeight));
			ctx.fillStyle = rightBarGradient;
			ctx.fillRect(i*increment, Math.floor(offset), increment, Math.floor(rightBarHeight));
		}
	}
}
